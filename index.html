<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì§€êµ¬ ì—´ìˆ˜ì§€ ì¸í„°ë™í‹°ë¸Œ í™œë™</title>
  <style>
    :root{--bg:#0b1220;--card:#ffffff;--muted:#6b7280;--accent:#2563eb;--good:#059669;--bad:#dc2626}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial,sans-serif;background:#f3f4f6;color:#111827}
    header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid #e5e7eb;padding:12px 16px;z-index:10}
    h1{margin:0;font-size:20px}
    main{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,.04);padding:16px;margin-bottom:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:960px){.row,.row-3{grid-template-columns:1fr}}
    img.hero{width:100%;height:auto;border-radius:12px;border:1px solid #e5e7eb}
    label{font-weight:600;font-size:14px}
    input[type="number"], input[type="text"], select{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;font-size:14px}
    input[type="range"]{width:100%}
    .btn{display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#1118270d;color:#111827;border:1px solid #e5e7eb}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#11182708;border:1px solid #e5e7eb;color:#374151;font-size:12px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-bottom:1px solid #e5e7eb;padding:8px 10px;text-align:left}
    .ok{color:var(--good);font-weight:700}
    .bad{color:var(--bad);font-weight:700}
    .metric{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
    .metric h4{margin:0 0 6px 0;font-size:13px;color:#6b7280}
    .metric .value{font-size:22px;font-weight:800}
    .muted{color:#6b7280}
    .footer{color:#6b7280;font-size:13px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.grid2{grid-template-columns:1fr}}
    .spacer{height:6px}
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒ ì§€êµ¬ ì—´ìˆ˜ì§€ ì¸í„°ë™í‹°ë¸Œ í™œë™</h1>
  </header>

  <main>
    <!-- ì´ë¯¸ì§€ ì„¹ì…˜ -->
    <section class="card">
      <div class="row">
        <div>
          <img id="diagram" class="hero" src="ì§€êµ¬ ì—´ìˆ˜ì§€.png" alt="íƒœì–‘Â·ì§€êµ¬ ë³µì‚¬ ì—ë„ˆì§€ ë‹¤ì´ì–´ê·¸ë¨" />
          <div class="spacer"></div>
          <div class="grid2">
            <div>
              <label for="imgUrl">ì´ë¯¸ì§€ ê²½ë¡œ/URL (ì„ íƒ)</label>
              <input id="imgUrl" type="text" placeholder="ì˜ˆ: images/diagram.png ë˜ëŠ” https://..." />
            </div>
            <div style="display:flex;gap:8px;align-items:flex-end;">
              <button class="btn secondary" id="applyImg">ì´ë¯¸ì§€ ë³€ê²½</button>
              <span class="muted">ê¸°ë³¸ê°’: ê°™ì€ í´ë”ì˜ <b>ì§€êµ¬ ì—´ìˆ˜ì§€.png</b></span>
            </div>
          </div>
        </div>
        <div>
          <p><span class="pill">ê°€ì •</span> ëª¨ë“  ê°’ì€ <b>ìƒëŒ€ê°’</b>ì…ë‹ˆë‹¤. (íƒœì–‘ ë³µì‚¬ ì—ë„ˆì§€ = 100)</p>
          <div class="card" style="padding:12px">
            <label for="blankCount">ë¹ˆì¹¸ ê°œìˆ˜: <span id="blankCountLabel">6</span>ê°œ</label>
            <input id="blankCount" type="range" min="3" max="13" value="6" />
            <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
              <button class="btn" id="reshuffle">ğŸ”„ ìƒˆ ë¹ˆì¹¸ ë½‘ê¸°</button>
              <button class="btn secondary" id="fillAllCorrect">ì •ë‹µ ìë™ ì±„ìš°ê¸°</button>
              <button class="btn secondary" id="clearBlanks">ë¹ˆì¹¸ë§Œ ë¹„ìš°ê¸°</button>
            </div>
            <p class="muted" style="margin-top:8px">â€» GitHub Pagesì— ì˜¬ë¦´ ê²½ìš°, ì´ HTMLê³¼ ì´ë¯¸ì§€ íŒŒì¼ì„ ê°™ì€ í´ë”ì— ë‘ì„¸ìš”.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ì…ë ¥ í¼ -->
    <section class="card">
      <h2 style="margin-top:0">â‘  ê°’ ì±„ìš°ê¸°</h2>
      <div id="inputs" class="row"></div>
    </section>

    <!-- ì±„ì /ê²°ê³¼ -->
    <section class="card">
      <h2 style="margin-top:0">â‘¡ ì±„ì  ê²°ê³¼</h2>
      <div id="scoreSummary" class="muted"></div>
      <div class="spacer"></div>
      <div style="overflow:auto">
        <table id="scoreTable">
          <thead>
            <tr>
              <th>í•­ëª©</th>
              <th>ì…ë ¥ê°’</th>
              <th>ì •ë‹µ</th>
              <th>ê²°ê³¼</th>
              <th>ì˜¤ì°¨(ì…ë ¥-ì •ë‹µ)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ì—´ìˆ˜ì§€ ê³„ì‚° -->
    <section class="card">
      <h2 style="margin-top:0">â‘¢ ì—´ìˆ˜ì§€ í™•ì¸ (ì…ë ¥ê°’ ê¸°ì¤€)</h2>
      <div class="row">
        <div>
          <h3 style="margin:0 0 8px 0">(A) ëŒ€ê¸°ê¶Œ ìƒë‹¨ TOA</h3>
          <div class="grid2">
            <div class="metric"><h4>ë“¤ì–´ì˜´(íƒœì–‘)</h4><div class="value" id="toaIn">-</div></div>
            <div class="metric"><h4>ë‚˜ê°(ë°˜ì‚¬+ë³µì‚¬)</h4><div class="value" id="toaOut">-</div></div>
            <div class="metric"><h4>ìˆ˜ì§€(ë“¤ì–´ì˜´-ë‚˜ê°)</h4><div class="value" id="toaBal">-</div></div>
          </div>
          <p class="muted" id="toaMsg"></p>
        </div>
        <div>
          <h3 style="margin:0 0 8px 0">(B) ì§€í‘œ</h3>
          <div class="grid2">
            <div class="metric"><h4>ì…ë ¥(í¡ìˆ˜+ì¬ë³µì‚¬)</h4><div class="value" id="surfIn">-</div></div>
            <div class="metric"><h4>ì¶œë ¥(ë³µì‚¬+ì ì—´+ê°ì—´)</h4><div class="value" id="surfOut">-</div></div>
            <div class="metric"><h4>ìˆ˜ì§€(ì…ë ¥-ì¶œë ¥)</h4><div class="value" id="surfBal">-</div></div>
          </div>
          <p class="muted">ì°¸ê³ : ìë£Œë§ˆë‹¤ <em>ëŒ€ê¸°ì°½(12)</em> ì²˜ë¦¬ ë“±ì´ ë‹¬ë¼ ìˆ˜ì¹˜ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª©ì ì€ <b>ê´€ê³„ ì´í•´ì™€ ê³„ì‚° ì—°ìŠµ</b>ì…ë‹ˆë‹¤.</p>
        </div>
      </div>
    </section>

    <!-- ë‚´ë³´ë‚´ê¸° -->
    <section class="card">
      <h2 style="margin-top:0">â‘£ í™œë™ì§€ ë‚´ë³´ë‚´ê¸°</h2>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn secondary" id="downloadWS">ğŸ“ í™œë™ì§€ CSV</button>
        <button class="btn secondary" id="downloadKey">âœ… ì •ë‹µì§€ CSV</button>
      </div>
    </section>

    <p class="footer">Â© 2025 â€¢ CC-BY êµìœ¡ìš©. ì´ í˜ì´ì§€ëŠ” í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ GitHub Pagesì—ì„œ ê·¸ëŒ€ë¡œ ì‘ë™í•©ë‹ˆë‹¤.</p>
  </main>

  <script>
    // ===== ì •ë‹µ ë§ˆìŠ¤í„° =====
    const ANSWER_KEY = {
      S_in: { label: "íƒœì–‘ ë³µì‚¬ ì—ë„ˆì§€ (ë“¤ì–´ì˜´)", value: 100 },
      albedo_total: { label: "ì§€êµ¬ì˜ ë°˜ì‚¬(ì „ì²´)", value: 30 },
      albedo_low: { label: "ëŒ€ê¸°/êµ¬ë¦„/ëŒ€ê¸°ê¶Œ ë°˜ì‚¬", value: 25 },
      albedo_surface: { label: "ì§€í‘œì—ì„œì˜ ë°˜ì‚¬", value: 5 },
      S_abs_surface: { label: "ì§€í‘œë©´ í¡ìˆ˜(íƒœì–‘ë³µì‚¬)", value: 50 },
      S_abs_atm: { label: "ëŒ€ê¸°ì™€ êµ¬ë¦„ì˜ í¡ìˆ˜(íƒœì–‘ë³µì‚¬)", value: 20 },
      L_out_space: { label: "ìš°ì£¼ë¡œ ë‚˜ê°€ëŠ” ì§€êµ¬ ë³µì‚¬", value: 70 },
      L_emit_atm_to_space: { label: "ëŒ€ê¸°ì™€ êµ¬ë¦„ì˜ ë°©ì¶œ(ìš°ì£¼ë¡œ)", value: 58 },
      L_emit_surface: { label: "ì§€í‘œë©´ ë³µì‚¬(ìƒí–¥)", value: 102 },
      L_window: { label: "ëŒ€ê¸° ì°½ì„ í†µí•´ ì§ì ‘ ìš°ì£¼ë¡œ(ì§€í‘œì—ì„œ)", value: 12 },
      L_back: { label: "ëŒ€ê¸°ì˜ ì¬ë³µì‚¬(í•˜í–¥)", value: 94 },
      H: { label: "ëŒ€ë¥˜ì™€ ì „ë„(ê°ì—´, ìƒí–¥)", value: 7 },
      LE: { label: "ë¬¼ì˜ ì¦ë°œ(ì ì—´, ìƒí–¥)", value: 23 }
    };
    const ALL_KEYS = Object.keys(ANSWER_KEY);

    // ===== ìƒíƒœ =====
    let blanks = [];

    // ìœ í‹¸
    function randInt(n){ return Math.floor(Math.random()*n); }
    function sample(arr, k){
      const copy = [...arr];
      const out = [];
      for(let i=0;i<k && copy.length>0;i++){
        const idx = randInt(copy.length);
        out.push(copy[idx]);
        copy.splice(idx,1);
      }
      return out;
    }
    function numberOrNull(v){ const x = parseFloat(v); return Number.isFinite(x)? x : null; }

    // UI ìš”ì†Œ
    const inputsDiv = document.getElementById('inputs');
    const blankCount = document.getElementById('blankCount');
    const blankCountLabel = document.getElementById('blankCountLabel');

    // ì´ë¯¸ì§€ ì ìš©
    document.getElementById('applyImg').addEventListener('click', ()=>{
      const url = document.getElementById('imgUrl').value.trim();
      if(url) document.getElementById('diagram').src = url;
    });

    // ë¹ˆì¹¸ ì„¤ì •
    function chooseBlanks(){
      const n = parseInt(blankCount.value,10);
      blanks = sample(ALL_KEYS, n);
    }

    function createInput(label, key){
      const wrap = document.createElement('div');
      const lab = document.createElement('label'); lab.textContent = label; lab.htmlFor = `inp_${key}`; wrap.appendChild(lab);
      const inp = document.createElement('input');
      inp.type = 'number'; inp.step = 'any'; inp.id = `inp_${key}`; inp.placeholder = blanks.includes(key)? '(ë¹ˆì¹¸)' : '';
      inp.value = blanks.includes(key)? '' : ANSWER_KEY[key].value;
      inp.addEventListener('input', updateAll);
      wrap.appendChild(inp);
      return wrap;
    }

    function renderInputs(){
      inputsDiv.innerHTML = '';
      const half = Math.ceil(ALL_KEYS.length/2);
      const left = document.createElement('div'); left.className = 'card';
      const right = document.createElement('div'); right.className = 'card';
      const leftFrag = document.createElement('div'); leftFrag.className='grid2';
      const rightFrag = document.createElement('div'); rightFrag.className='grid2';
      ALL_KEYS.forEach((k, i)=>{
        const el = createInput(ANSWER_KEY[k].label, k);
        (i<half? leftFrag : rightFrag).appendChild(el);
      });
      left.appendChild(leftFrag); right.appendChild(rightFrag);
      inputsDiv.appendChild(left); inputsDiv.appendChild(right);
    }

    // ì±„ì /ê³„ì‚°
    function readInputs(){
      const out = {};
      ALL_KEYS.forEach(k=>{
        const el = document.getElementById(`inp_${k}`);
        out[k] = el? numberOrNull(el.value) : null;
        if(out[k]===null && !blanks.includes(k)){
          // ë¹ˆì¹¸ì´ ì•„ë‹ˆë©´ ì •ë‹µ ê¸°ë³¸ê°’ ì‚¬ìš©
          out[k] = ANSWER_KEY[k].value;
        }
      });
      return out;
    }

    function buildScoreTable(values){
      const tbody = document.querySelector('#scoreTable tbody');
      tbody.innerHTML = '';
      let correct = 0;
      ALL_KEYS.forEach(k=>{
        const tr = document.createElement('tr');
        const truth = ANSWER_KEY[k].value;
        const user = values[k];
        const ok = (user!==null) && Math.abs(user - truth) < 1e-9;
        if(ok) correct++;
        const diff = (user===null)? '' : (ok? '' : (user - truth));
        tr.innerHTML = `
          <td>${ANSWER_KEY[k].label}</td>
          <td>${user===null? '<span class="muted">ë¯¸ì…ë ¥</span>' : user}</td>
          <td>${truth}</td>
          <td class="${ok? 'ok':'bad'}">${ok? 'ì •ë‹µ':'ì˜¤ë‹µ'}</td>
          <td>${diff}</td>`;
        tbody.appendChild(tr);
      });
      document.getElementById('scoreSummary').innerHTML = `âœ… ì •ë‹µ ê°œìˆ˜: <b>${correct}</b> / ${ALL_KEYS.length}`;
    }

    function updateBalances(values){
      const S_in = values.S_in ?? ANSWER_KEY.S_in.value;
      const albedo_total = values.albedo_total ?? ANSWER_KEY.albedo_total.value;
      const L_out_space = values.L_out_space ?? ANSWER_KEY.L_out_space.value;

      const S_abs_surface = values.S_abs_surface ?? ANSWER_KEY.S_abs_surface.value;
      const L_back = values.L_back ?? ANSWER_KEY.L_back.value;
      const L_emit_surface = values.L_emit_surface ?? ANSWER_KEY.L_emit_surface.value;
      const LE = values.LE ?? ANSWER_KEY.LE.value;
      const H = values.H ?? ANSWER_KEY.H.value;

      const toa_in = S_in;
      const toa_out = albedo_total + L_out_space;
      const toa_balance = toa_in - toa_out;

      const surface_in = S_abs_surface + L_back;
      const surface_out = L_emit_surface + LE + H;
      const surface_balance = surface_in - surface_out;

      const f = (x)=> Number.isFinite(x)? x.toFixed(0) : '-';
      document.getElementById('toaIn').textContent = f(toa_in);
      document.getElementById('toaOut').textContent = f(toa_out);
      document.getElementById('toaBal').textContent = f(toa_balance);
      document.getElementById('surfIn').textContent = f(surface_in);
      document.getElementById('surfOut').textContent = f(surface_out);
      document.getElementById('surfBal').textContent = f(surface_balance);

      const toaMsg = (Math.abs(toa_balance) < 1e-9) ?
        'TOA ìˆ˜ì§€ê°€ 0ì´ë¯€ë¡œ í–‰ì„± ê·œëª¨ì—ì„œ í‰í˜•ì…ë‹ˆë‹¤.' : 'TOA ìˆ˜ì§€ê°€ 0ì´ ì•„ë‹™ë‹ˆë‹¤. ê°’ì„ ë‹¤ì‹œ í™•ì¸í•´ ë³´ì„¸ìš”.';
      document.getElementById('toaMsg').textContent = toaMsg;
    }

    function updateAll(){
      const vals = readInputs();
      buildScoreTable(vals);
      updateBalances(vals);
    }

    // ë‹¤ìš´ë¡œë“œ (CSV)
    function toCSV(rows){
      const esc = s => '"' + String(s).replaceAll('"','""') + '"';
      if(rows.length===0) return '';
      const keys = Object.keys(rows[0]);
      const head = keys.map(esc).join(',');
      const body = rows.map(r => keys.map(k=>esc(r[k])).join(',')).join('\n');
      return head + '\n' + body;
    }

    function downloadBlob(filename, text){
      const blob = new Blob([text], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.style.display='none';
      document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
    }

    document.getElementById('downloadWS').addEventListener('click', ()=>{
      const wsRows = blanks.map(k=> ({ 'í•­ëª©í‚¤': k, 'í•­ëª©ë¼ë²¨': ANSWER_KEY[k].label, 'ì •ë‹µ(ë¹„ì›Œë‘ì„¸ìš”)': '' }));
      downloadBlob('ì—´ìˆ˜ì§€_í™œë™ì§€.csv', toCSV(wsRows));
    });
    document.getElementById('downloadKey').addEventListener('click', ()=>{
      const keyRows = blanks.map(k=> ({ 'í•­ëª©í‚¤': k, 'í•­ëª©ë¼ë²¨': ANSWER_KEY[k].label, 'ì •ë‹µ': ANSWER_KEY[k].value }));
      downloadBlob('ì—´ìˆ˜ì§€_ì •ë‹µì§€.csv', toCSV(keyRows));
    });

    // ë²„íŠ¼ë“¤
    document.getElementById('reshuffle').addEventListener('click', ()=>{ chooseBlanks(); renderInputs(); updateAll(); });
    document.getElementById('fillAllCorrect').addEventListener('click', ()=>{
      ALL_KEYS.forEach(k=>{ const el = document.getElementById(`inp_${k}`); if(el) el.value = ANSWER_KEY[k].value; });
      updateAll();
    });
    document.getElementById('clearBlanks').addEventListener('click', ()=>{
      blanks.forEach(k=>{ const el = document.getElementById(`inp_${k}`); if(el) el.value = ''; });
      updateAll();
    });

    // ì´ˆê¸°í™”
    blankCount.addEventListener('input', ()=>{ blankCountLabel.textContent = blankCount.value; });
    blankCountLabel.textContent = blankCount.value;
    chooseBlanks();
    renderInputs();
    updateAll();
  </script>
</body>
</html>
